<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="black">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<title>snake jam</title>

<style>
*{padding:0;margin:0;}
html,body{position: fixed;overflow: hidden;}
p {font-size:1em;}
main#main {margin:auto;text-align:center;}
canvas#canvas {background:#000000; touch-action: none;}
</style>

</head>

<body>
<main id="main">
<p>The game is loading, hopefully...</p>
<canvas id="canvas"></canvas>
</main>


<script src="js/globs.min.js"></script>
<script src="http://cdn.peerjs.com/0.3/peer.js"></script>
<script>
var getGame = () => {
    var result = null,
        tmp = [];
    location.search
        .substr(1)
        .split("&")
        .forEach((item) => {
          tmp = item.split("=");
          if (tmp[0] === "game") result = decodeURIComponent(tmp[1]);
        });
    return result;
}

const peer = new Peer({key: 'zv0cun3yg3f2yb9'});



peer.on("open",(id)=>{
	let gameId = getGame()
    if (gameId != null) {
	    var conn = peer.connect(gameId);
        conn.on('open', function(){
    	    conn.send('hi!');
    	    console.log("connection sent")
	    });
	}
	history.pushState("","","?game="+id)
})

</script>

<script>
var mainElement = document.getElementById("main");
var p = mainElement.getElementsByTagName("p")[0];
p.style.display="none"

if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('service-worker.js').then(function(registration) {
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
</script>

</body>

</html>
